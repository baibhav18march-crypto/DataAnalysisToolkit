# This workflow will build a Java project with Ant
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-ant

name: Java CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    - name: Build with Ant
      run: ant -noinput -buildfile build.xml

          - name: Create deployment artifact
                run: |
                        mkdir -p artifacts
                                cp -r com artifacts/
                                        echo "Build completed successfully" > artifacts/BUILD_INFO.txt

                                            - name: Upload artifact
                                                  uses: actions/upload-artifact@v3
                                                        with:
                                                                name: java-dataanalysis-toolkit
                                                                        path: artifacts/

                                                                          deploy:
                                                                              needs: build
                                                                                  runs-on: ubuntu-latest
                                                                                      permissions:
                                                                                            contents: write
                                                                                                  pages: write
                                                                                                        id-token: write
                                                                                                            steps:
                                                                                                                - uses: actions/checkout@v4
                                                                                                                    - name: Download artifact
                                                                                                                          uses: actions/download-artifact@v3
                                                                                                                                with:
                                                                                                                                        name: java-dataanalysis-toolkit
                                                                                                                                                path: ./deploy
                                                                                                                                                
                                                                                                                                                    - name: Create deployment info
                                                                                                                                                          run: |
                                                                                                                                                                  echo "Deployment successful at $(date)" > ./deploy/deployment.txt
                                                                                                                                                                          echo "Visit: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/" >> ./deploy/deployment.txt
                                                                                                                                                                          
                                                                                                                                                                              - name: Deploy to GitHub Pages
                                                                                                                                                                                    uses: peaceiris/actions-gh-pages@v3
                                                                                                                                                                                          with:
                                                                                                                                                                                                  github_token: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                                          publish_dir: ./deploy
